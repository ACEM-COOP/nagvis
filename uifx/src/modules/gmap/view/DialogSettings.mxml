<?xml version="1.0" encoding="utf-8"?>
<!--
 Copyright (C) 2009 NagVis Project
 
 License:
 
 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License version 2 as
 published by the Free Software Foundation.
 
 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.
 
 You should have received a copy of the GNU General Public License
 along with this program; if not, write to the Free Software
 Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
-->
<EdgeBox xmlns="lib.ui.*"
	xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:flexlib="http://code.google.com/p/flexlib/"
	contracted="addEventListener(MouseEvent.CLICK, onClick)"
	expanded="removeEventListener(MouseEvent.CLICK, onClick)"
>
    <mx:Script>
    	<![CDATA[
    		import modules.gmap.domain.Settings;
    		import modules.gmap.events.SettingsEvent;

			private var _settings : Settings;

			public function set settings(settings : Settings) : void
			{
				_settings = settings;

				key.text = settings.googleMapsKey;

				if(settings.defaultLocationAction && settings.defaultLocationAction.length > 0)
				{
					var slices:Array = settings.defaultLocationAction.split(':', 2);
					switch(slices[0])
					{
						case 'nagios':
							settingsAction.selectedIndex = 1;
							break;
						case 'nagvis':
							settingsAction.selectedIndex = 2;
							settingsActionMaps.text = slices[1];
							break;
						case 'http':
						case 'https':
							settingsAction.selectedIndex = 3;
							settingsActionURL.text = settings.defaultLocationAction;
							break;
						default:
							settingsAction.selectedIndex = 0;
					}
					onActionChanges();
				}
			}

			private function onActionChanges():void
			{			
				switch(settingsAction.selectedIndex)
				{
					case 2:
						settingsAction.setStyle('top', 30);
						settingsActionMaps.visible = true; 
						settingsActionURL.visible = false;
						break;
					case 3:
						settingsAction.setStyle('top', 30);
						settingsActionMaps.visible = false; 
						settingsActionURL.visible = true;
						break;
					default:
						settingsAction.setStyle('top', 50);
						settingsActionMaps.visible = settingsActionURL.visible = false;
				}
			}

			private function onApply() : void
			{
				var eventType : String = (key.text == _settings.googleMapsKey)?
					SettingsEvent.CHANGE : SettingsEvent.RELOAD;

				_settings.googleMapsKey = key.text;
				_settings.openLinksInNewWindow = false;

				switch(settingsAction.selectedIndex)
				{
					case 1:
						_settings.defaultLocationAction = 'nagios:';
						break;
					case 2:
						_settings.defaultLocationAction = 'nagvis:' + settingsActionMaps.text;
						break;
					case 3:
						_settings.defaultLocationAction = settingsActionURL.text;
						break;
					default:
						_settings.defaultLocationAction = null;
				}

				dispatchEvent(new SettingsEvent(eventType, _settings));
			}
    	]]>
    </mx:Script>
    <mx:Metadata>
        [Event(name="getGMapKey", type="flash.events.Event")]
    </mx:Metadata>
	<mx:HBox left="10" right="15" top="10" height="20">
		<mx:Image id="logo" source="@Embed(source='modules/gmap/img/cog.png')"/>
		<mx:Label text="Settings"/>
		<mx:Spacer width="100%"/>
		<mx:Image id="close"
			source="@Embed(source='modules/gmap/img/control_fastforward.png')"
			click="setCurrentState('right-contracted'); event.stopImmediatePropagation()"
		/>
	</mx:HBox>
	<mx:Canvas left="10" right="15" top="40" bottom="10">
		<flexlib:HAccordion selectedIndex="0" left="0" right="0" top="0" height="138" styleName="accordion" creationPolicy="all">
			<mx:Canvas label="Google Maps Key" width="100%" height="100%">
				<flexlib:PromptingTextInput id="key"
				 	left="10" right="10" top="0" height="22"
					cornerRadius="4" prompt="Google Maps Key"
				/>
				<mx:LinkButton label="Get Google Maps Key"
					left="10" right="10" top="30" textAlign="left"
					icon="@Embed(source='modules/gmap/img/key.png')"
					click="dispatchEvent(new Event('getGMapKey'))"
				/>
			</mx:Canvas>
			<mx:Canvas label="Default Actions" width="100%" height="100%" horizontalScrollPolicy="off">
				<mx:Canvas left="5" right="0" top="10" bottom="0" borderStyle="solid" cornerRadius="4" borderColor="#000000">
					<mx:ComboBox id="settingsAction" change="onActionChanges()"
						left="5" right="5" top="50"
					>
						<mx:ArrayCollection>
							<mx:String>default action</mx:String>
							<mx:String>open Nagios details page</mx:String>
							<mx:String>open NagVis map</mx:String>
							<mx:String>go to URL</mx:String>
						</mx:ArrayCollection>
					</mx:ComboBox>
					<mx:ComboBox id="settingsActionMaps" visible="false"
						left="5" right="5" top="70"
					/>
					<mx:TextInput id="settingsActionURL" visible="false"
						left="5" right="5" top="70"
					/>
				</mx:Canvas>
				<mx:TextInput cornerRadius="10" text="On Double Click" top="0" left="15" width="100" borderStyle="solid" editable="false"/>
			</mx:Canvas>
		</flexlib:HAccordion>
		<mx:Button label="Apply" right="0" bottom="0" height="22" click="onApply()"/>
	</mx:Canvas>
</EdgeBox>
